services:
  accounts-service:
    build:
      context: ../apps/accounts-service
    image: novareport/accounts-service:dev
    environment:
      SPRING_PROFILES_ACTIVE: dev
      JWT_SECRET: dev-secret-change-me-please-32-bytes-minimum
    ports:
      - '8080:8080'
    networks:
      - novareport

  subscriptions-service:
    build:
      context: ../apps/subscriptions-service
    image: novareport/subscriptions-service:dev
    environment:
      SPRING_PROFILES_ACTIVE: dev
      JWT_SECRET: dev-secret-change-me-please-32-bytes-minimum
      JWT_ISSUER: accounts-service
      SUBS_FAKE_ALL_ACTIVE: 'true'
      INTERNAL_API_KEY: dev-change-me
    ports:
      - '8081:8080'
    networks:
      - novareport
    depends_on:
      - accounts-service

  reporter-service:
    build:
      context: ../apps/reporter-service
    image: novareport/reporter-service:dev
    environment:
      SPRING_PROFILES_ACTIVE: dev
      JWT_SECRET: dev-secret-change-me-please-32-bytes-minimum
      JWT_ISSUER: accounts-service
      INTERNAL_API_KEY: dev-change-me
      SUBS_BASE_URL: http://subscriptions-service:8080
      NOTIF_BASE_URL: http://notifications-service:8083
      RSS_FEEDS: https://cointelegraph.com/rss
      REPORTER_FAKE_AI: 'false'
      REPORTER_DEDUP_WINDOW_HOURS: '48'
      ONEMIN_API_KEY: ${ONEMIN_API_KEY:-}
      ONEMIN_MODEL: ${ONEMIN_MODEL:-gpt-4o-mini}
    ports:
      - '8082:8080'
    volumes:
      - reporter-h2:/app/data/h2/reporter-service
    networks:
      - novareport
    depends_on:
      - accounts-service
      - subscriptions-service

  payments-xmr-service:
    build:
      context: ../apps/payments-xmr-service
    image: novareport/payments-xmr-service:dev
    environment:
      SPRING_PROFILES_ACTIVE: dev
      # WARNING: Do not use hard-coded secrets in production!
      # Use Docker secrets, environment files, or secret management tools.
      JWT_SECRET: dev-secret-change-me-please-32-bytes-minimum
      JWT_ISSUER: accounts-service
      INTERNAL_API_KEY: dev-change-me
      SUBSCRIPTIONS_BASE_URL: http://subscriptions-service:8080
    ports:
      - '8084:8084'
    networks:
      - novareport
    depends_on:
      - subscriptions-service

  notifications-service:
    build:
      context: ../apps/notifications-service
    image: novareport/notifications-service:dev
    environment:
      SPRING_PROFILES_ACTIVE: dev
      JWT_SECRET: dev-secret-change-me-please-32-bytes-minimum
      JWT_ISSUER: accounts-service
      JWT_ACCESS_TOKEN_MINUTES: '30'
      INTERNAL_API_KEY: dev-change-me
    ports:
      - '8083:8083'
    networks:
      - novareport
    depends_on:
      - accounts-service

  frontend:
    build:
      context: ../apps/frontend
      args:
        VITE_ACCOUNTS_API_BASE: http://localhost:8080
        VITE_SUBS_API_BASE: http://localhost:8081
        VITE_NOTIF_API_BASE: http://localhost:8083
        VITE_REPORTER_API_BASE: http://localhost:8082
        VITE_PAYMENTS_API_BASE: http://localhost:8084
        VITE_INTERNAL_API_KEY: dev-change-me
    image: novareport/frontend:dev
    ports:
      - '5173:80'
    networks:
      - novareport
    depends_on:
      - accounts-service
      - subscriptions-service
      - payments-xmr-service

networks:
  novareport:
    driver: bridge

volumes:
  reporter-h2:
